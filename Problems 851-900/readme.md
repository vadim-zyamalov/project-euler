# Задачи 851-900

## Задача 872

На форуме есть несколько довольно продвинутых решений (очень продвинутых).
Однако если нарисовать от руки несколько деревьев, то закономерность становится понятной.

Разница между родительским узлом и любым дочерним является степенью двойки.
Причем путь от $n$ к $k$ однозначно описывается единицами в двоичном представлении $n-k$.

### Формальное доказательство

Докажем по индукции.
Обозначим через $T_n$ дерево с корнем $n$.

Для задания базы индукции построим деревья для $n = 1, \dots$.
Количество деревьев индивидульно; оно должно быть достаточным, чтобы заметить следующее:

1. у корня $n$ дочерние узлы равны $n - 2^i$, где $i = 0, \dots, \lfloor \log_2 (n - 1)\rfloor$.
   Правая граница гарантирует, что мы не перейдем через единицу.
2. у узла $k = n - \dots - 2^i$, где $\dots$ --- некий набор степеней 2, не превышающих $i$, дочерние узлы равны
   $$k - 2^{i+1}, k - 2 ^{i+2}, \dots, \lfloor \log_2 (k - 1) \rfloor - i$$

Нетрудно убедиться, что данные выражения справедливы для $n = 1, \dots, 12$.
В принципе, можно продолжить до любого необходимого $n$.

Предположим теперь, что все описанное выше справедливо для дерева $T_n$.

Построим дерево $T_{n+1}$.
Из описанного выше и правил построения дерева следует, что на *главной* траектории, то есть той, из которой формируются дочерние узлы нового корня, расположены узлы
$$n,\ n - 2^0,\ n - 2^0 - 2^1,\ n - 2^0 - 2^1 - 2^2, \dots$$
Очевидно, что эти узлы можно представить в виде
$$n = (n+1) - 1$$
$$(n+1) - 1 - 2^0 = (n+1) - 2^1$$
$$(n+1) - 1 - 2^0 - 2^1 = (n+1) - 2^1 - 2^1 = (n+1) - 2^2, \dots$$
то есть для $T_{n+1}$ сохраняются соотношения для дочерних узлов корневого узла.

Рассмотрим субдерево с корнем в узле *главной* траектории и дочерними узлами за вычетом дочернего узла с той же *главной* траектории;
возьмем узел $K = n - \sum_{i=1}^k 2^i$.
В $T_{n+1}$ он будет $k + 1$ дочерним узлом корневого узла $n+1$.
Выше было показано, что $K = (n+1) - 2^{k+1}$.
Его оставшиеся дочерние узлы равны
$$K - 2^{k + 2},\ K - 2^{k + 3}, \dots$$
Таким образом, соотношения для дочерних узлов некорневого узла в $T_{n+1}$ также сохраняются.

Прочие узлы можно не рассматривать, так как набор их дочерних узлов не менялся, соответственно не менялись и соотношения между ними.

То есть, если соотношения для дочерних узлов выполняются для $T_n$, то они также будут выполняться для $T_{n+1}$.
